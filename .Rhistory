file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Methadone scenario
l_params_MET_MMS <- load_all_params(file.init = "data/Modified Model Specification/init_params.csv",
file.init_dist = "data/init_dist_met.csv",
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv",
file.fentanyl = "data/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Mixed proportions for validation
l_params_all_validation_MMS <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
View(l_params_MET_MMS)
library(dplyr)    # to manipulate data
# Call model setup functions
# To-do: Move into package eventually
source("R/input_parameter_functions.R")
# Load parameters
# Calibrated parameter values
load(file = "outputs/Calibration/imis_output.RData")
######################################
#### Modified Model Specification ####
######################################
# BNX scenario
l_params_BUP_MMS <- load_all_params(file.init = "data/Modified Model Specification/init_params.csv",
file.init_dist = "data/init_dist_bup.csv",
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv",
file.fentanyl = "data/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Methadone scenario
l_params_MET_MMS <- load_all_params(file.init = "data/Modified Model Specification/init_params.csv",
file.init_dist = "data/init_dist_met.csv",
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv",
file.fentanyl = "data/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Mixed proportions for validation
l_params_all_validation_MMS <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
View(l_params_MET_MMS)
rm(list = ls()) # to clean the workspace
#### Load packages, data and functions ####
#### Load packages and functions ####
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
library(grid)
library(gridExtra)
library(lattice)
# To-do: Move functions into R package for OUD model
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
View(l_params_all)
# Load calibration inputs #
v_cali_param_names <- c("'Overdose rate (BNX/MET)'",
"'Overdose rate (BNX/MET + opioid)'",
"'Overdose rate (opioid use)'",
"'Overdose rate (opioid cessation)'",
"'First month mult (BNX/MET + opioid)'",
"'Fentanyl mult'",
"'Fatal overdose rate'",
"'Probability overdose witnessed")
v_par1 <- c(n_TX_OD_shape   = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape  = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape   = l_params_all$n_REL_OD_shape,
n_ABS_OD_low    = l_params_all$n_ABS_OD_low,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_fent_OD_mult_low = l_params_all$n_fent_OD_mult_low,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape,
p_witness = l_params_all$p_witness_low)### R&R MODIFICATION ###
v_par2 <- c(n_TX_OD_scale   = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale  = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale   = l_params_all$n_REL_OD_scale,
n_ABS_OD_high    = l_params_all$n_ABS_OD_high,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_fent_OD_mult_high = l_params_all$n_fent_OD_mult_high,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale,
p_witness = l_params_all$p_witness_high)### R&R MODIFICATION ###
#### Load calibration targets ####
l_cali_targets <- list(ODF = read.csv(file = "data/cali_target_odf.csv", header = TRUE),
ODN = read.csv(file = "data/cali_target_odn.csv", header = TRUE))
View(l_cali_targets)
# Max calibration periods
n_cali_max_per <- max(c(l_cali_targets$ODF$Time, l_cali_targets$ODN$Time))
#### Visualize targets ####
### TARGET 1: Overdose deaths ("ODF")
plotrix::plotCI(x    = l_cali_targets$ODF$Time,
y    = l_cali_targets$ODF$pe,
ui   = l_cali_targets$ODF$high,
li   = l_cali_targets$ODF$low,
#ylim = c(0, 1),
xlab = "Month", ylab = "Fatal Overdoses")
### TARGET 2: Non-fatal overdose ("ODN")
plotrix::plotCI(x    = l_cali_targets$ODN$Time,
y    = l_cali_targets$ODN$pe,
ui   = l_cali_targets$ODN$high,
li   = l_cali_targets$ODN$low,
#ylim = c(0, 1),
xlab = "Month", ylab = "Non-fatal Overdoses")
#### Specify calibration parameters ####
### Specify seed (for reproducible sequence of random numbers)
set.seed(3730687)
### Number of random samples to obtain from the posterior distribution
n_resamp <- 10000 # to match number of PSA draws
### Number of calibration targets
v_target_names <- c("Fatal Overdoses", "Non-fatal Overdoses")
n_target       <- length(v_target_names)
View(l_params_all)
### Select time-points ###
### Overdose deaths ###
n_ODF_t1 <- l_cali_targets$ODF$Time[1]
n_ODF_t2 <- l_cali_targets$ODF$Time[2]
n_ODF_t3 <- l_cali_targets$ODF$Time[3]
n_ODF_t4 <- l_cali_targets$ODF$Time[4]### R&R MODIFICATION ###
### Non-fatal overdose ###
n_ODN_t1 <- l_cali_targets$ODN$Time[1]
n_ODN_t2 <- l_cali_targets$ODN$Time[2]
n_ODN_t3 <- l_cali_targets$ODN$Time[3]
n_ODN_t4 <- l_cali_targets$ODN$Time[4]### R&R MODIFICATION ###
### Subset output by time-points ###
### Overdose deaths ###
# Yearly fatal overdoses
n_ODF1 <- v_ODF[n_ODF_t1]
rm(list = ls()) # to clean the workspace
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
library(formattable)
# Call model setup functions
# To-do: Move into package eventually
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/ICER_functions.R")
# Load parameters
source("Analysis/00_load_parameters.R") # load all model parameters for each scenario + calibrated parameters
#### Produce model outputs ####
#### Modified Model Specification ####
l_outcomes_BUP_MMS  <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map)
# Probability of naloxone use
v_NX_used <- c(p_NX_2017, p_NX_2018, p_NX_2019, p_NX_2020)### R&R MODIFICATION ###
rm(list = ls()) # to clean the workspace
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
library(formattable)
# Call model setup functions
# To-do: Move into package eventually
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/ICER_functions.R")
# Load parameters
source("Analysis/00_load_parameters.R") # load all model parameters for each scenario + calibrated parameters
View(l_params_BUP_MMS)
#### Produce model outputs ####
#### Modified Model Specification ####
l_outcomes_BUP_MMS  <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map)
l_outcomes_MET_MMS  <- outcomes(l_params_all = l_params_MET_MMS, v_params_calib = v_calib_post_map)
rm(list = ls()) # to clean the workspace
#### Load packages, data and functions ####
#### Load packages and functions ####
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
library(grid)
library(gridExtra)
library(lattice)
# To-do: Move functions into R package for OUD model
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("'Overdose rate (BNX/MET)'",
"'Overdose rate (BNX/MET + opioid)'",
"'Overdose rate (opioid use)'",
"'Overdose rate (opioid cessation)'",
"'First month mult (BNX/MET + opioid)'",
"'Fentanyl mult'",
"'Fatal overdose rate'",
"'Probability overdose witnessed")
v_par1 <- c(n_TX_OD_shape       = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape      = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape      = l_params_all$n_REL_OD_shape,
n_ABS_OD_low        = l_params_all$n_ABS_OD_low,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_fent_OD_mult_low  = l_params_all$n_fent_OD_mult_low,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape,
p_witness           = l_params_all$p_witness_low)### R&R MODIFICATION ###
v_par2 <- c(n_TX_OD_scale       = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale      = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale      = l_params_all$n_REL_OD_scale,
n_ABS_OD_high       = l_params_all$n_ABS_OD_high,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_fent_OD_mult_high = l_params_all$n_fent_OD_mult_high,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale,
p_witness           = l_params_all$p_witness_high)### R&R MODIFICATION ###
#### Load calibration targets ####
l_cali_targets <- list(ODF = read.csv(file = "data/cali_target_odf.csv", header = TRUE),
ODN = read.csv(file = "data/cali_target_odn.csv", header = TRUE))
# Max calibration periods
n_cali_max_per <- max(c(l_cali_targets$ODF$Time, l_cali_targets$ODN$Time))
#### Visualize targets ####
### TARGET 1: Overdose deaths ("ODF")
plotrix::plotCI(x    = l_cali_targets$ODF$Time,
y    = l_cali_targets$ODF$pe,
ui   = l_cali_targets$ODF$high,
li   = l_cali_targets$ODF$low,
xlab = "Month", ylab = "Fatal Overdoses")
### TARGET 2: Non-fatal overdose ("ODN")
plotrix::plotCI(x    = l_cali_targets$ODN$Time,
y    = l_cali_targets$ODN$pe,
ui   = l_cali_targets$ODN$high,
li   = l_cali_targets$ODN$low,
xlab = "Month", ylab = "Non-fatal Overdoses")
#### Specify calibration parameters ####
### Set seed
set.seed(3730687)
### Number of random samples to obtain from the posterior distribution
n_resamp <- 10000 # to match number of PSA draws
### Number of calibration targets
v_target_names <- c("Fatal Overdoses", "Non-fatal Overdoses")
n_target       <- length(v_target_names)
rm(list = ls()) # to clean the workspace
#### Load packages, data and functions ####
#### Load packages and functions ####
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
library(grid)
library(gridExtra)
library(lattice)
# To-do: Move functions into R package for OUD model
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("'Overdose rate (BNX/MET)'",
"'Overdose rate (BNX/MET + opioid)'",
"'Overdose rate (opioid use)'",
"'Overdose rate (opioid cessation)'",
"'First month mult (BNX/MET + opioid)'",
"'Fentanyl mult'",
"'Fatal overdose rate'",
"'Probability overdose witnessed")
v_par1 <- c(n_TX_OD_shape       = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape      = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape      = l_params_all$n_REL_OD_shape,
n_ABS_OD_low        = l_params_all$n_ABS_OD_low,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_fent_OD_mult_low  = l_params_all$n_fent_OD_mult_low,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape,
p_witness           = l_params_all$p_witness_low)### R&R MODIFICATION ###
v_par2 <- c(n_TX_OD_scale       = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale      = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale      = l_params_all$n_REL_OD_scale,
n_ABS_OD_high       = l_params_all$n_ABS_OD_high,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_fent_OD_mult_high = l_params_all$n_fent_OD_mult_high,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale,
p_witness           = l_params_all$p_witness_high)### R&R MODIFICATION ###
#### Load calibration targets ####
l_cali_targets <- list(ODF = read.csv(file = "data/cali_target_odf.csv", header = TRUE),
ODN = read.csv(file = "data/cali_target_odn.csv", header = TRUE))
# Max calibration periods
n_cali_max_per <- max(c(l_cali_targets$ODF$Time, l_cali_targets$ODN$Time))
#### Visualize targets ####
### TARGET 1: Overdose deaths ("ODF")
plotrix::plotCI(x    = l_cali_targets$ODF$Time,
y    = l_cali_targets$ODF$pe,
ui   = l_cali_targets$ODF$high,
li   = l_cali_targets$ODF$low,
xlab = "Month", ylab = "Fatal Overdoses")
### TARGET 2: Non-fatal overdose ("ODN")
plotrix::plotCI(x    = l_cali_targets$ODN$Time,
y    = l_cali_targets$ODN$pe,
ui   = l_cali_targets$ODN$high,
li   = l_cali_targets$ODN$low,
xlab = "Month", ylab = "Non-fatal Overdoses")
#### Specify calibration parameters ####
### Set seed
set.seed(3730687)
### Number of random samples to obtain from the posterior distribution
n_resamp <- 10000 # to match number of PSA draws
### Number of calibration targets
v_target_names <- c("Fatal Overdoses", "Non-fatal Overdoses")
n_target       <- length(v_target_names)
#### Run IMIS algorithm ####
l_fit_imis <- IMIS(B = 1000,      # n_samp = B*10 (was 100 incremental sample size at each iteration of IMIS)
B.re = n_resamp,      # "n_resamp" desired posterior sample size
number_k = 500,      # maximum number of iterations in IMIS (originally 10)
D = 0) # originally 0
rm(list = ls()) # to clean the workspace
#### Load packages, data and functions ####
#### Load packages and functions ####
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
library(grid)
library(gridExtra)
library(lattice)
# To-do: Move functions into R package for OUD model
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/Calibration/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on BC OUD cohort data for 2018
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull = "data/Modified Model Specification/weibull.csv",
file.unconditional = "data/Modified Model Specification/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.fentanyl = "data/Calibration/fentanyl.csv",
file.naloxone = "data/naloxone.csv",### R&R MODIFICATION ###
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/Modified Model Specification/costs.csv",
file.crime_costs = "data/Modified Model Specification/crime_costs.csv",
file.qalys = "data/Modified Model Specification/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("'Overdose rate (BNX/MET)'",
"'Overdose rate (BNX/MET + opioid)'",
"'Overdose rate (opioid use)'",
"'Overdose rate (opioid cessation)'",
"'First month mult (BNX/MET + opioid)'",
"'Fentanyl mult'",
"'Fatal overdose rate'",
"'Probability overdose witnessed")
v_par1 <- c(n_TX_OD_shape       = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape      = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape      = l_params_all$n_REL_OD_shape,
n_ABS_OD_low        = l_params_all$n_ABS_OD_low,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_fent_OD_mult_low  = l_params_all$n_fent_OD_mult_low,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape,
p_witness           = l_params_all$p_witness_low)### R&R MODIFICATION ###
v_par2 <- c(n_TX_OD_scale       = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale      = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale      = l_params_all$n_REL_OD_scale,
n_ABS_OD_high       = l_params_all$n_ABS_OD_high,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_fent_OD_mult_high = l_params_all$n_fent_OD_mult_high,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale,
p_witness           = l_params_all$p_witness_high)### R&R MODIFICATION ###
#### Load calibration targets ####
l_cali_targets <- list(ODF = read.csv(file = "data/cali_target_odf.csv", header = TRUE),
ODN = read.csv(file = "data/cali_target_odn.csv", header = TRUE))
# Max calibration periods
n_cali_max_per <- max(c(l_cali_targets$ODF$Time, l_cali_targets$ODN$Time))
#### Visualize targets ####
### TARGET 1: Overdose deaths ("ODF")
plotrix::plotCI(x    = l_cali_targets$ODF$Time,
y    = l_cali_targets$ODF$pe,
ui   = l_cali_targets$ODF$high,
li   = l_cali_targets$ODF$low,
xlab = "Month", ylab = "Fatal Overdoses")
### TARGET 2: Non-fatal overdose ("ODN")
plotrix::plotCI(x    = l_cali_targets$ODN$Time,
y    = l_cali_targets$ODN$pe,
ui   = l_cali_targets$ODN$high,
li   = l_cali_targets$ODN$low,
xlab = "Month", ylab = "Non-fatal Overdoses")
#### Specify calibration parameters ####
### Set seed
set.seed(3730687)
### Number of random samples to obtain from the posterior distribution
n_resamp <- 10000 # to match number of PSA draws
### Number of calibration targets
v_target_names <- c("Fatal Overdoses", "Non-fatal Overdoses")
n_target       <- length(v_target_names)
#### Run IMIS algorithm ####
l_fit_imis <- IMIS(B = 100,      # n_samp = B*10 (was 100 incremental sample size at each iteration of IMIS)
B.re = n_resamp,      # "n_resamp" desired posterior sample size
number_k = 500,      # maximum number of iterations in IMIS (originally 10)
D = 0) # originally 0
