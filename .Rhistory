file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("n_TX_OD",
"n_TXC_OD",
"n_REL_OD",
#"n_ABS_OD",
"n_TX_OD_mult",
"n_TXC_OD_mult",
"n_REL_OD_mult",
"n_INJ_OD_mult",
"n_fatal_OD")
v_shape <- c(n_TX_OD_shape   = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape  = l_params_all$n_TXC_OD_shape,
#n_MET_OD_shape   = l_params_all$n_MET_OD_shape,
#n_METC_OD_shape  = l_params_all$n_METC_OD_shape,
n_REL_OD_shape   = l_params_all$n_REL_OD_shape,
#n_ABS_OD_shape   = l_params_all$n_ABS_OD_shape,
n_TX_OD_mult_shape  = l_params_all$n_TX_OD_mult_shape,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_REL_OD_mult_shape = l_params_all$n_REL_OD_mult_shape,
n_INJ_OD_mult_shape = l_params_all$n_INJ_OD_mult_shape,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape) # lower bound estimate for each param
v_scale <- c(n_TX_OD_scale   = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale  = l_params_all$n_TXC_OD_scale,
#n_MET_OD_scale   = l_params_all$n_MET_OD_scale,
#n_METC_OD_scale  = l_params_all$n_METC_OD_scale,
n_REL_OD_scale   = l_params_all$n_REL_OD_scale,
#n_ABS_OD_scale   = l_params_all$n_ABS_OD_scale,
n_TX_OD_mult_scale  = l_params_all$n_TX_OD_mult_scale,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_REL_OD_mult_scale = l_params_all$n_REL_OD_mult_scale,
n_INJ_OD_mult_scale = l_params_all$n_INJ_OD_mult_scale,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale)
test2 <- sample.prior(n_samp = 100)
View(test2)
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
# Call model setup functions
# To-do: Move into package eventually
source("R/OPTIMA_00_input_parameter_functions.R")
source("R/OPTIMA_01_model_setup_functions.R")
source("R/OPTIMA_05b_ICER_functions.R")
# Load parameters
# BNX scenario
l_params_BUP <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist_bup.csv", # Change initial distributions (100% in BUP)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv",
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
# Methadone scenario
l_params_MET <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist_met.csv", # Change initial distributions (100% in MET)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv",
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
### Main deterministic model outputs ###
# Run Markov model and return outputs
outcomes_MET <- outcomes(l_params_all = l_params_MET)
outcomes_BUP <- outcomes(l_params_all = l_params_BUP)
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
# Call model setup functions
# To-do: Move into package eventually
source("R/OPTIMA_00_input_parameter_functions.R")
source("R/OPTIMA_01_model_setup_functions.R")
source("R/OPTIMA_05b_ICER_functions.R")
# Load parameters
# BNX scenario
l_params_BUP <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist_bup.csv", # Change initial distributions (100% in BUP)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv",
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
# Methadone scenario
l_params_MET <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist_met.csv", # Change initial distributions (100% in MET)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv",
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
### Main deterministic model outputs ###
# Run Markov model and return outputs
outcomes_MET <- outcomes(l_params_all = l_params_MET)
outcomes_BUP <- outcomes(l_params_all = l_params_BUP)
View(test2)
write.csv(test2, row.names = TRUE)
write.csv(test2,"checks/priors.csv", row.names = TRUE)
load("~/GitHub/OPTIMA-Model/outputs/imis_output.RData")
View(m_calib_post)
data_long <- gather(m_calib_post, parameter, draw, factor_key=TRUE)
data_long
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
# Prepare data
data_long <- gather(m_calib_post, parameter, draw, factor_key=TRUE)
data_long
#### Plot prior vs. posterior distribution for calibration parameters ####
# Prepare data
data_wide <- as.data.frame(m_calib_post)
data_long <- gather(data_wide, parameter, draw, factor_key=TRUE)
View(data_long)
View(data_long)
View(data_wide)
df_calib_post <- as.data.frame(m_calib_post)
# Base overdose rates
df_calib_plot <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_BUP_OD" | parameter == "n_BUPC_OD" | parameter == "n_MET_OD" | parameter == "n_METC_OD" | parameter == "n_REL_OD")
View(data_wide)
ggplot(
df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
scale_fill_viridis_c(name = "Temp. [F]", option = "C") +
labs(title = 'Temperatures in Lincoln NE')
# Base overdose rates
df_calib_post_plot_base <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_BUP_OD" | parameter == "n_BUPC_OD" | parameter == "n_MET_OD" | parameter == "n_METC_OD" | parameter == "n_REL_OD")
# Overdose rate multipliers
df_calib_post_plot_mult <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Fatal overdose rate
df_calib_post_plot_mult <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Base overdose rates
ggplot(
df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
scale_fill_viridis_c(name = "Temp. [F]", option = "C") +
labs(title = 'Temperatures in Lincoln NE')
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
scale_fill_viridis_c(name = "Monthly rate", option = "C") +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
#### Plot prior vs. posterior distribution for calibration parameters ####
# Draw sample prior
m_calib_prior <- sample.prior(n_samp = 2000)
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on full trial sample (x% bup; x% met)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("n_TX_OD",
"n_TXC_OD",
"n_REL_OD",
"n_TX_OD_mult",
"n_TXC_OD_mult",
"n_REL_OD_mult",
"n_INJ_OD_mult",
"n_fatal_OD")
v_shape <- c(n_TX_OD_shape   = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape  = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape   = l_params_all$n_REL_OD_shape,
n_TX_OD_mult_shape  = l_params_all$n_TX_OD_mult_shape,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_REL_OD_mult_shape = l_params_all$n_REL_OD_mult_shape,
n_INJ_OD_mult_shape = l_params_all$n_INJ_OD_mult_shape,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape) # lower bound estimate for each param
v_scale <- c(n_TX_OD_scale   = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale  = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale   = l_params_all$n_REL_OD_scale,
n_TX_OD_mult_scale  = l_params_all$n_TX_OD_mult_scale,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_REL_OD_mult_scale = l_params_all$n_REL_OD_mult_scale,
n_INJ_OD_mult_scale = l_params_all$n_INJ_OD_mult_scale,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale)
#### Plot prior vs. posterior distribution for calibration parameters ####
# Draw sample prior
m_calib_prior <- sample.prior(n_samp = 2000)
View(m_calib_prior)
rm(list = ls()) # to clean the workspace
#### Load packages, data and functions ####
#### Load packages and functions ####
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(ggridges) # specialized ridge plots
library(tidyverse)
library(lhs)
library(IMIS)
# To-do: Move functions into R package for OUD model
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/calibration_functions.R")
load("~/GitHub/OPTIMA-Model/outputs/imis_output.RData")
# Prepare data
df_calib_post  <- as.data.frame(m_calib_post)
df_calib_prior <- as.data.frame(m_calib_prior)
# Base overdose rates
df_calib_post_plot_base  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_BUP_OD" | parameter == "n_BUPC_OD" | parameter == "n_MET_OD" | parameter == "n_METC_OD" | parameter == "n_REL_OD")
# Overdose rate multipliers
df_calib_post_plot_mult  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Fatal overdose rate
df_calib_post_plot_fatal <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
scale_fill_viridis_c(name = "Monthly rate", option = "C") +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
View(df_calib_post_plot_base)
View(df_calib_post)
#### Plot prior vs. posterior distribution for calibration parameters ####
# Draw sample prior
m_calib_prior <- sample.prior(n_samp = 2000)
# Prepare data
df_calib_post  <- as.data.frame(m_calib_post)
df_calib_prior <- as.data.frame(m_calib_prior)
# Base overdose rates
df_calib_post_plot_base  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD" | parameter == "n_TXC_OD" | parameter == "n_REL_OD")
# Overdose rate multipliers
df_calib_post_plot_mult  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Fatal overdose rate
df_calib_post_plot_fatal <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
scale_fill_viridis_c(name = "Monthly rate", option = "C") +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
View(df_calib_post)
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = stat(x))) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter)) +
geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter)) +
#geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
geom_density_ridges(aes(fill = parameter)) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
#### Plot prior vs. posterior distribution for calibration parameters ####
# Draw sample prior
m_calib_prior <- sample.prior(n_samp = 2000)
# Load calibration inputs #
v_cali_param_names <- c("n_TX_OD",
"n_TXC_OD",
"n_REL_OD",
"n_TX_OD_mult",
"n_TXC_OD_mult",
"n_REL_OD_mult",
"n_INJ_OD_mult",
"n_fatal_OD")
v_shape <- c(n_TX_OD_shape   = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape  = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape   = l_params_all$n_REL_OD_shape,
n_TX_OD_mult_shape  = l_params_all$n_TX_OD_mult_shape,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_REL_OD_mult_shape = l_params_all$n_REL_OD_mult_shape,
n_INJ_OD_mult_shape = l_params_all$n_INJ_OD_mult_shape,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape) # lower bound estimate for each param
v_scale <- c(n_TX_OD_scale   = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale  = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale   = l_params_all$n_REL_OD_scale,
n_TX_OD_mult_scale  = l_params_all$n_TX_OD_mult_scale,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_REL_OD_mult_scale = l_params_all$n_REL_OD_mult_scale,
n_INJ_OD_mult_scale = l_params_all$n_INJ_OD_mult_scale,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale)
# Load model inputs #
l_params_all <- load_all_params(file.init = "data/init_params.csv",
file.init_dist = "data/init_dist.csv", # calibrate on full trial sample (x% bup; x% met)
file.mort = "data/all_cause_mortality.csv",
file.death_hr = "data/death_hr.csv",
file.frailty = "data/frailty.csv",
file.weibull_scale = "data/weibull_scale.csv",
file.weibull_shape = "data/weibull_shape.csv",
file.unconditional = "data/unconditional.csv",
file.overdose = "data/overdose.csv", # includes calibration-related parameters
file.hiv = "data/hiv_sero.csv",
file.hcv = "data/hcv_sero.csv",
file.costs = "data/costs.csv",
file.crime_costs = "data/crime_costs.csv",
file.qalys = "data/qalys.csv")
# Load calibration inputs #
v_cali_param_names <- c("n_TX_OD",
"n_TXC_OD",
"n_REL_OD",
"n_TX_OD_mult",
"n_TXC_OD_mult",
"n_REL_OD_mult",
"n_INJ_OD_mult",
"n_fatal_OD")
v_shape <- c(n_TX_OD_shape   = l_params_all$n_TX_OD_shape,
n_TXC_OD_shape  = l_params_all$n_TXC_OD_shape,
n_REL_OD_shape   = l_params_all$n_REL_OD_shape,
n_TX_OD_mult_shape  = l_params_all$n_TX_OD_mult_shape,
n_TXC_OD_mult_shape = l_params_all$n_TXC_OD_mult_shape,
n_REL_OD_mult_shape = l_params_all$n_REL_OD_mult_shape,
n_INJ_OD_mult_shape = l_params_all$n_INJ_OD_mult_shape,
n_fatal_OD_shape    = l_params_all$n_fatal_OD_shape) # lower bound estimate for each param
v_scale <- c(n_TX_OD_scale   = l_params_all$n_TX_OD_scale,
n_TXC_OD_scale  = l_params_all$n_TXC_OD_scale,
n_REL_OD_scale   = l_params_all$n_REL_OD_scale,
n_TX_OD_mult_scale  = l_params_all$n_TX_OD_mult_scale,
n_TXC_OD_mult_scale = l_params_all$n_TXC_OD_mult_scale,
n_REL_OD_mult_scale = l_params_all$n_REL_OD_mult_scale,
n_INJ_OD_mult_scale = l_params_all$n_INJ_OD_mult_scale,
n_fatal_OD_scale    = l_params_all$n_fatal_OD_scale)
#### Plot prior vs. posterior distribution for calibration parameters ####
# Draw sample prior
m_calib_prior <- sample.prior(n_samp = 2000)
View(m_calib_prior)
View(df_calib_post)
df_calib_post  <- as.data.frame(m_calib_post) %>% rename(n_TX_OD_post  = n_TX_OD,
n_TXC_OD_post = n_TXC_OD,
n_REL_OD_post = n_REL_OD)
View(df_calib_post)
View(df_calib_post)
View(df_calib_post)
View(df_calib_post)
df_calib_prior_post <- merge(df_calib_prior, df_calib_post)
df_calib_post  <- as.data.frame(m_calib_post) %>% rename(n_TX_OD_post  = n_TX_OD,
n_TXC_OD_post = n_TXC_OD,
n_REL_OD_post = n_REL_OD,
n_TX_OD_mult_post = n_TX_OD_mult,
n_TXC_OD_mult_post = n_TXC_OD_mult,
n_REL_OD_mult_post = n_REL_OD_mult,
n_INJ_OD_mult_post = n_INJ_OD_mult,
n_fatal_od_post = n_fatal_od)
df_calib_prior <- as.data.frame(m_calib_prior) %>% rename(n_TX_OD_prior  = n_TX_OD,
n_TXC_OD_prior = n_TXC_OD,
n_REL_OD_prior = n_REL_OD,
n_TX_OD_mult_prior = n_TX_OD_mult,
n_TXC_OD_mult_prior = n_TXC_OD_mult,
n_REL_OD_mult_prior = n_REL_OD_mult,
n_INJ_OD_mult_prior = n_INJ_OD_mult,
n_fatal_od_prior = n_fatal_od)
df_calib_prior_post <- merge(df_calib_prior, df_calib_post)
df_calib_post  <- as.data.frame(m_calib_post) %>% mutate(count = n()) %>% rename(n_TX_OD_post  = n_TX_OD,
n_TXC_OD_post = n_TXC_OD,
n_REL_OD_post = n_REL_OD,
n_TX_OD_mult_post = n_TX_OD_mult,
n_TXC_OD_mult_post = n_TXC_OD_mult,
n_REL_OD_mult_post = n_REL_OD_mult,
n_INJ_OD_mult_post = n_INJ_OD_mult,
n_fatal_od_post = n_fatal_od)
df_calib_prior <- as.data.frame(m_calib_prior) %>% mutate(count = n()) %>% rename(n_TX_OD_prior  = n_TX_OD,
n_TXC_OD_prior = n_TXC_OD,
n_REL_OD_prior = n_REL_OD,
n_TX_OD_mult_prior = n_TX_OD_mult,
n_TXC_OD_mult_prior = n_TXC_OD_mult,
n_REL_OD_mult_prior = n_REL_OD_mult,
n_INJ_OD_mult_prior = n_INJ_OD_mult,
n_fatal_od_prior = n_fatal_od)
View(df_calib_post)
df_calib_post  <- as.data.frame(m_calib_post) %>% mutate(ID = row_number()) %>% rename(n_TX_OD_post  = n_TX_OD,
n_TXC_OD_post = n_TXC_OD,
n_REL_OD_post = n_REL_OD,
n_TX_OD_mult_post = n_TX_OD_mult,
n_TXC_OD_mult_post = n_TXC_OD_mult,
n_REL_OD_mult_post = n_REL_OD_mult,
n_INJ_OD_mult_post = n_INJ_OD_mult,
n_fatal_od_post = n_fatal_od)
df_calib_prior <- as.data.frame(m_calib_prior) %>% mutate(ID = row_number()) %>% rename(n_TX_OD_prior  = n_TX_OD,
n_TXC_OD_prior = n_TXC_OD,
n_REL_OD_prior = n_REL_OD,
n_TX_OD_mult_prior = n_TX_OD_mult,
n_TXC_OD_mult_prior = n_TXC_OD_mult,
n_REL_OD_mult_prior = n_REL_OD_mult,
n_INJ_OD_mult_prior = n_INJ_OD_mult,
n_fatal_od_prior = n_fatal_od)
View(df_calib_post)
df_calib_prior_post <- merge(df_calib_prior, df_calib_post, by.x = "ID", by.y = "ID")
View(df_calib_prior_post)
# Base overdose rates
df_calib_post_plot_base  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_post" | parameter == "n_TX_OD_prior" | parameter == "n_TXC_OD_post" | parameter == "n_TXC_OD_prior" | parameter == "n_REL_OD_post" | parameter == "n_REL_OD_prior")
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter)) +
#geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
geom_density_ridges(aes(fill = parameter)) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
View(df_calib_prior_post)
View(df_calib_post_plot_base)
# Base overdose rates
df_calib_post_plot_base  <- gather(df_calib_prior_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_post" | parameter == "n_TX_OD_prior" | parameter == "n_TXC_OD_post" | parameter == "n_TXC_OD_prior" | parameter == "n_REL_OD_post" | parameter == "n_REL_OD_prior")
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter)) +
#geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
geom_density_ridges(aes(fill = parameter)) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#2ca25f", "#e5f5f9", "#3182bd", "#deebf7", "#e6550d", "#fee6ce")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
# Base overdose rates
df_calib_post_plot_base  <- gather(df_calib_prior_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_post" | parameter == "n_TX_OD_prior" | parameter == "n_TXC_OD_post" | parameter == "n_TXC_OD_prior" | parameter == "n_REL_OD_post" | parameter == "n_REL_OD_prior")
base_order <- factor(df_calib_post_plot_base$parameter, levels = c("n_TX_OD_post", "n_TX_OD_prior", "n_TXC_OD_post", "n_TXC_OD_prior", "n_REL_OD_post", "n_REL_OD_prior"))
# Overdose rate multipliers
df_calib_post_plot_mult  <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Fatal overdose rate
df_calib_post_plot_fatal <- gather(df_calib_post, parameter, draw, factor_key = TRUE) %>% filter(parameter == "n_TX_OD_mult" | parameter == "n_TXC_OD_mult" | parameter == "n_REL_OD_mult" | parameter == "n_INJ_OD_mult")
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter, fill = base_order)) +
#geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
geom_density_ridges(aes(fill = parameter)) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#2ca25f", "#e5f5f9", "#3182bd", "#deebf7", "#e6550d", "#fee6ce")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
# Base overdose rates
cali_base_od_prior_post <- ggplot(df_calib_post_plot_base,
aes(x = draw, y = parameter)) +
#geom_density_ridges_gradient(scale = 3, size = 0.3, rel_min_height = 0.01) +
geom_density_ridges(aes(fill = base_order)) +
#scale_fill_viridis_c(name = "Monthly rate", option = "C") +
scale_fill_manual(values = c("#2ca25f", "#e5f5f9", "#3182bd", "#deebf7", "#e6550d", "#fee6ce")) +
labs(title = 'Base Overdose Rates')
pdf("Plots/Calibration/cali_base_od_prior_post.pdf", width = 8, height = 6)
cali_base_od_prior_post
dev.off()
load("~/GitHub/OPTIMA-Model/outputs/imis_output.RData")
View(m_calib_post)
