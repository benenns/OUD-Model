###################
## Threshold ##
df_threshold_MMS <- data.frame()
# MMS
for (i in 1:10){
df_threshold_MMS[nrow(df_threshold_MMS) + i,] <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
}
# MMS
for (i in 1:10){
df_threshold_MMS[i,] <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
}
###################
### Transitions ###
###################
## Threshold ##
df_threshold_MMS <- data.frame()
# MMS
for (i in 1:10){
df_threshold_MMS[i,] <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
}
df_threshold_MMS_temp <- data.frame()
# MMS
for (i in 1:10){
df_threshold_MMS_temp <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
View(df_threshold_MMS)
View(df_threshold_MMS)
v_ICER_names <- c("n_inc_costs_TOTAL_1yr", "n_inc_costs_TOTAL_5yr", "n_inc_costs_TOTAL_10yr", "n_inc_qalys_TOTAL_1yr", "n_inc_qalys_TOTAL_5yr", "n_inc_qalys_TOTAL_10yr",
"n_icer_TOTAL_1yr", "n_icer_TOTAL_5yr", "n_icer_TOTAL_10yr")
# MMS
for (i in 1:10){
df_threshold_MMS_temp <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
names(df_threshold_MMS) <- v_ICER_names
View(df_threshold_MMS)
###################
### Transitions ###
###################
## Threshold ##
df_threshold_MMS <- data.frame()
df_threshold_MMS_temp <- data.frame()
v_ICER_names <- c("n_inc_costs_TOTAL_1yr", "n_inc_costs_TOTAL_5yr", "n_inc_costs_TOTAL_10yr", "n_inc_qalys_TOTAL_1yr", "n_inc_qalys_TOTAL_5yr", "n_inc_qalys_TOTAL_10yr",
"n_icer_TOTAL_1yr", "n_icer_TOTAL_5yr", "n_icer_TOTAL_10yr")
# MMS
for (i in 1:10){
df_threshold_MMS_temp <- data.frame(ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
names(df_threshold_MMS) <- v_ICER_names
View(df_threshold_MMS)
# Initialize lists
l_outcomes_MET_threshold_MMS <- list()
l_outcomes_BUP_threshold_MMS <- list()
ICER_threshold_MMS <- list()
## Treatment retention (threshold SA for BNX retention) ##
for (i in 1:nrow(m_dsa_threshold_MMS)){
# +i%
l_outcomes_MET_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_MET_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_outcomes_BUP_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_ICER_threshold_MMS[[i]] <- ICER(outcomes_comp = l_outcomes_MET_threshold_MMS[[i]], outcomes_int = l_outcomes_BUP_threshold_MMS[[i]])
}
###################
### Transitions ###
###################
# Initialize lists
l_outcomes_MET_threshold_MMS <- list()
l_outcomes_BUP_threshold_MMS <- list()
l_ICER_threshold_MMS <- list()
## Treatment retention (threshold SA for BNX retention) ##
for (i in 1:nrow(m_dsa_threshold_MMS)){
# +i%
l_outcomes_MET_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_MET_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_outcomes_BUP_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_ICER_threshold_MMS[[i]] <- ICER(outcomes_comp = l_outcomes_MET_threshold_MMS[[i]], outcomes_int = l_outcomes_BUP_threshold_MMS[[i]])
}
df_threshold_MMS <- data.frame()
df_threshold_MMS_temp <- data.frame()
v_ICER_names <- c("n_inc_costs_TOTAL_1yr", "n_inc_costs_TOTAL_5yr", "n_inc_costs_TOTAL_10yr", "n_inc_qalys_TOTAL_1yr", "n_inc_qalys_TOTAL_5yr", "n_inc_qalys_TOTAL_10yr",
"n_icer_TOTAL_1yr", "n_icer_TOTAL_5yr", "n_icer_TOTAL_10yr")
# MMS
for (i in 1:nrow(m_dsa_threshold_MMS)){
df_threshold_MMS_temp <- data.frame(l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
names(df_threshold_MMS) <- v_ICER_names
View(df_threshold_MMS)
View(df_threshold_MMS)
rm(list = ls()) # to clean the workspace
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
library(data.table)
library(formattable)
library(tidyr)
library(RColorBrewer)
# Call model setup functions
# To-do: Move into package eventually
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/ICER_functions.R")
# Load parameters
source("Analysis/00_load_parameters.R")
###################
### Transitions ###
###################
df_dsa_threshold_MMS <- read.csv(file = "data/DSA/Modified Model Specification/threshold.csv", row.names = 1, header = TRUE)
df_dsa_threshold_TS <- read.csv(file = "data/DSA/Trial Specification/threshold.csv", row.names = 1, header = TRUE)
# Initialize matrices
v_threshold_names_MMS <- colnames(df_dsa_threshold_MMS)
v_threshold_names_TS <- colnames(df_dsa_threshold_TS)
m_dsa_threshold_MMS <- array(0, dim = c(nrow(df_dsa_threshold_MMS), length(df_dsa_threshold_MMS)),
dimnames = list(1:nrow(df_dsa_threshold_MMS), v_threshold_names_MMS))
m_dsa_threshold_TS <- array(0, dim = c(nrow(df_dsa_threshold_TS), length(df_dsa_threshold_TS)),
dimnames = list(1:nrow(df_dsa_threshold_TS), v_threshold_names_TS))
## Threshold SA ##
# MMS
m_dsa_threshold_MMS[1,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_1",])
m_dsa_threshold_MMS[2,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_2",])
m_dsa_threshold_MMS[3,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_3",])
m_dsa_threshold_MMS[4,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_4",])
m_dsa_threshold_MMS[5,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_5",])
m_dsa_threshold_MMS[6,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_6",])
m_dsa_threshold_MMS[7,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_7",])
m_dsa_threshold_MMS[8,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_8",])
m_dsa_threshold_MMS[9,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_9",])
m_dsa_threshold_MMS[10,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_10",])
m_dsa_threshold_MMS[11,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_11",])
m_dsa_threshold_MMS[12,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_12",])
m_dsa_threshold_MMS[13,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_13",])
m_dsa_threshold_MMS[14,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_14",])
m_dsa_threshold_MMS[15,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_15",])
m_dsa_threshold_MMS[16,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_16",])
m_dsa_threshold_MMS[17,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_17",])
m_dsa_threshold_MMS[18,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_18",])
m_dsa_threshold_MMS[19,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_19",])
m_dsa_threshold_MMS[20,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_20",])
m_dsa_threshold_MMS[21,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_21",])
m_dsa_threshold_MMS[22,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_22",])
m_dsa_threshold_MMS[23,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_23",])
m_dsa_threshold_MMS[24,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_24",])
m_dsa_threshold_MMS[25,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_25",])
m_dsa_threshold_MMS[26,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_26",])
m_dsa_threshold_MMS[27,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_27",])
m_dsa_threshold_MMS[28,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_28",])
m_dsa_threshold_MMS[29,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_29",])
m_dsa_threshold_MMS[30,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_30",])
m_dsa_threshold_MMS[31,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_31",])
m_dsa_threshold_MMS[32,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_32",])
m_dsa_threshold_MMS[33,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_33",])
m_dsa_threshold_MMS[34,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_34",])
m_dsa_threshold_MMS[35,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_35",])
m_dsa_threshold_MMS[36,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_36",])
m_dsa_threshold_MMS[37,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_37",])
m_dsa_threshold_MMS[38,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_38",])
m_dsa_threshold_MMS[39,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_39",])
m_dsa_threshold_MMS[40,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_40",])
m_dsa_threshold_MMS[41,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_41",])
m_dsa_threshold_MMS[42,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_42",])
m_dsa_threshold_MMS[43,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_43",])
m_dsa_threshold_MMS[44,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_44",])
m_dsa_threshold_MMS[45,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_45",])
m_dsa_threshold_MMS[46,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_46",])
m_dsa_threshold_MMS[47,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_47",])
m_dsa_threshold_MMS[48,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_48",])
m_dsa_threshold_MMS[49,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_49",])
m_dsa_threshold_MMS[50,] <- unlist(df_dsa_threshold_MMS["pe_bnx_threshold_50",])
# TS
m_dsa_threshold_TS[1,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_1",])
m_dsa_threshold_TS[2,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_2",])
m_dsa_threshold_TS[3,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_3",])
m_dsa_threshold_TS[4,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_4",])
m_dsa_threshold_TS[5,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_5",])
m_dsa_threshold_TS[6,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_6",])
m_dsa_threshold_TS[7,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_7",])
m_dsa_threshold_TS[8,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_8",])
m_dsa_threshold_TS[9,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_9",])
m_dsa_threshold_TS[10,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_10",])
m_dsa_threshold_TS[11,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_11",])
m_dsa_threshold_TS[12,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_12",])
m_dsa_threshold_TS[13,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_13",])
m_dsa_threshold_TS[14,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_14",])
m_dsa_threshold_TS[15,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_15",])
m_dsa_threshold_TS[16,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_16",])
m_dsa_threshold_TS[17,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_17",])
m_dsa_threshold_TS[18,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_18",])
m_dsa_threshold_TS[19,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_19",])
m_dsa_threshold_TS[20,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_20",])
m_dsa_threshold_TS[21,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_21",])
m_dsa_threshold_TS[22,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_22",])
m_dsa_threshold_TS[23,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_23",])
m_dsa_threshold_TS[24,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_24",])
m_dsa_threshold_TS[25,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_25",])
m_dsa_threshold_TS[26,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_26",])
m_dsa_threshold_TS[27,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_27",])
m_dsa_threshold_TS[28,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_28",])
m_dsa_threshold_TS[29,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_29",])
m_dsa_threshold_TS[30,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_30",])
m_dsa_threshold_TS[31,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_31",])
m_dsa_threshold_TS[32,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_32",])
m_dsa_threshold_TS[33,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_33",])
m_dsa_threshold_TS[34,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_34",])
m_dsa_threshold_TS[35,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_35",])
m_dsa_threshold_TS[36,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_36",])
m_dsa_threshold_TS[37,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_37",])
m_dsa_threshold_TS[38,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_38",])
m_dsa_threshold_TS[39,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_39",])
m_dsa_threshold_TS[40,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_40",])
m_dsa_threshold_TS[41,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_41",])
m_dsa_threshold_TS[42,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_42",])
m_dsa_threshold_TS[43,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_43",])
m_dsa_threshold_TS[44,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_44",])
m_dsa_threshold_TS[45,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_45",])
m_dsa_threshold_TS[46,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_46",])
m_dsa_threshold_TS[47,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_47",])
m_dsa_threshold_TS[48,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_48",])
m_dsa_threshold_TS[49,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_49",])
m_dsa_threshold_TS[50,] <- unlist(df_dsa_threshold_TS["pe_bnx_threshold_50",])
# Initialize lists
l_outcomes_MET_threshold_MMS <- list()
l_outcomes_BUP_threshold_MMS <- list()
l_ICER_threshold_MMS <- list()
## Treatment retention (threshold SA for BNX retention) ##
for (i in 1:nrow(m_dsa_threshold_MMS)){
# +i%
l_outcomes_MET_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_MET_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_outcomes_BUP_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_ICER_threshold_MMS[[i]] <- ICER(outcomes_comp = l_outcomes_MET_threshold_MMS[[i]], outcomes_int = l_outcomes_BUP_threshold_MMS[[i]])
}
## Threshold ##
df_threshold_MMS <- data.frame()
df_threshold_MMS_temp <- data.frame()
v_ICER_names <- c("n_inc_costs_TOTAL_1yr", "n_inc_costs_TOTAL_5yr", "n_inc_costs_TOTAL_10yr", "n_inc_qalys_TOTAL_1yr",
"n_inc_qalys_TOTAL_5yr", "n_inc_qalys_TOTAL_10yr", "n_icer_TOTAL_1yr", "n_icer_TOTAL_5yr", "n_icer_TOTAL_10yr")
# MMS
for (i in 1:nrow(m_dsa_threshold_MMS)){
df_threshold_MMS_temp <- data.frame(l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
names(df_threshold_MMS) <- v_ICER_names
View(df_threshold_MMS)
###################
### Transitions ###
###################
df_dsa_threshold_MMS <- read.csv(file = "data/DSA/Modified Model Specification/threshold.csv", row.names = 1, header = TRUE)
View(df_dsa_threshold_MMS)
# Initialize matrices
v_threshold_names_MMS <- colnames(df_dsa_threshold_MMS)
m_dsa_threshold_MMS <- array(0, dim = c(nrow(df_dsa_threshold_MMS), length(df_dsa_threshold_MMS)),
dimnames = list(1:nrow(df_dsa_threshold_MMS), v_threshold_names_MMS))
## Threshold SA ##
# MMS
for (i in 1:nrow(df_dsa_threshold_MMS)){
m_dsa_threshold_MMS[i,] <- unlist(df_dsa_threshold_MMS[i,])
}
View(m_dsa_threshold_MMS)
rm(list = ls()) # to clean the workspace
library(dplyr)    # to manipulate data
library(reshape2) # to transform data
library(ggplot2)  # for nice looking plots
library(tidyverse)
library(data.table)
library(formattable)
library(tidyr)
library(RColorBrewer)
# Call model setup functions
# To-do: Move into package eventually
source("R/input_parameter_functions.R")
source("R/model_setup_functions.R")
source("R/ICER_functions.R")
# Load parameters
source("Analysis/00_load_parameters.R")
df_dsa_threshold_MMS <- read.csv(file = "data/DSA/Modified Model Specification/threshold.csv", row.names = 1, header = TRUE)
df_dsa_threshold_TS <- read.csv(file = "data/DSA/Trial Specification/threshold.csv", row.names = 1, header = TRUE)
# Initialize matrices
v_threshold_names_MMS <- colnames(df_dsa_threshold_MMS)
v_threshold_names_TS <- colnames(df_dsa_threshold_TS)
m_dsa_threshold_MMS <- array(0, dim = c(nrow(df_dsa_threshold_MMS), length(df_dsa_threshold_MMS)),
dimnames = list(1:nrow(df_dsa_threshold_MMS), v_threshold_names_MMS))
m_dsa_threshold_TS <- array(0, dim = c(nrow(df_dsa_threshold_TS), length(df_dsa_threshold_TS)),
dimnames = list(1:nrow(df_dsa_threshold_TS), v_threshold_names_TS))
## Threshold SA ##
# MMS
for (i in 1:nrow(df_dsa_threshold_MMS)){
m_dsa_threshold_MMS[i,] <- unlist(df_dsa_threshold_MMS[i,])
}
# Initialize lists
l_outcomes_MET_threshold_MMS <- list()
l_outcomes_BUP_threshold_MMS <- list()
l_ICER_threshold_MMS <- list()
## Treatment retention (threshold SA for BNX retention) ##
for (i in 1:nrow(m_dsa_threshold_MMS)){
# +i%
l_outcomes_MET_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_MET_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_outcomes_BUP_threshold_MMS[[i]] <- outcomes(l_params_all = l_params_BUP_MMS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_MMS[i,])
l_ICER_threshold_MMS[[i]] <- ICER(outcomes_comp = l_outcomes_MET_threshold_MMS[[i]], outcomes_int = l_outcomes_BUP_threshold_MMS[[i]])
}
df_threshold_MMS <- data.frame()
df_threshold_MMS_temp <- data.frame()
v_ICER_names <- c("n_inc_costs_TOTAL_1yr", "n_inc_costs_TOTAL_5yr", "n_inc_costs_TOTAL_10yr", "n_inc_qalys_TOTAL_1yr",
"n_inc_qalys_TOTAL_5yr", "n_inc_qalys_TOTAL_10yr", "n_icer_TOTAL_1yr", "n_icer_TOTAL_5yr", "n_icer_TOTAL_10yr")
# MMS
for (i in 1:nrow(m_dsa_threshold_MMS)){
df_threshold_MMS_temp <- data.frame(l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_1yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_5yr, l_ICER_threshold_MMS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_MMS <- rbind(df_threshold_MMS, df_threshold_MMS_temp)
}
names(df_threshold_MMS) <- v_ICER_names
View(df_threshold_MMS)
View(df_dsa_threshold_TS)
# TS
for (i in 1:nrow(df_dsa_threshold_TS)){
m_dsa_threshold_TS[i,] <- unlist(df_dsa_threshold_TS[i,])
}
View(m_dsa_threshold_TS)
l_outcomes_MET_threshold_TS <- list()
l_outcomes_BUP_threshold_TS <- list()
l_ICER_threshold_TS <- list()
# TS
for (i in 1:nrow(m_dsa_threshold_TS)){
# +i%
l_outcomes_MET_threshold_TS[[i]] <- outcomes(l_params_all = l_params_MET_TS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_TS[i,])
l_outcomes_BUP_threshold_TS[[i]] <- outcomes(l_params_all = l_params_BUP_TS, v_params_calib = v_calib_post_map, v_params_dsa = m_dsa_threshold_TS[i,])
l_ICER_threshold_TS[[i]] <- ICER(outcomes_comp = l_outcomes_MET_threshold_TS[[i]], outcomes_int = l_outcomes_BUP_threshold_TS[[i]])
}
df_threshold_TS <- data.frame()
df_threshold_TS_temp <- data.frame()
# TS
for (i in 1:nrow(m_dsa_threshold_TS)){
df_threshold_TS_temp <- data.frame(l_ICER_threshold_TS[[i]]$df_incremental$n_inc_costs_TOTAL_1yr, l_ICER_threshold_TS[[i]]$df_incremental$n_inc_costs_TOTAL_5yr,
l_ICER_threshold_TS[[i]]$df_incremental$n_inc_costs_TOTAL_10yr, l_ICER_threshold_TS[[i]]$df_incremental$n_inc_qalys_TOTAL_1yr,
l_ICER_threshold_TS[[i]]$df_incremental$n_inc_qalys_TOTAL_5yr, l_ICER_threshold_TS[[i]]$df_incremental$n_inc_qalys_TOTAL_10yr,
l_ICER_threshold_TS[[i]]$df_icer$n_icer_TOTAL_1yr, l_ICER_threshold_TS[[i]]$df_icer$n_icer_TOTAL_5yr, l_ICER_threshold_TS[[i]]$df_icer$n_icer_TOTAL_10yr)
df_threshold_TS <- rbind(df_threshold_TS, df_threshold_TS_temp)
}
names(df_threshold_TS) <- v_ICER_names
View(df_threshold_TS)
# Prepare data for plotting
df_threshold_MMS %>% gather(key, value, ..., na.rm = FALSE, convert = FALSE)
# Prepare data for plotting
df_threshold_MMS %>% as_tibble() %>% mutate(perc_increase = row_number())
df_threshold_MMS %>% gather("key", "value", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE)
df_threshold_MMS_plot <- df_threshold_MMS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(scenario, inc_qalys)
View(df_threshold_MMS_plot)
# Prepare data for plotting
df_threshold_MMS %>% as_tibble() %>% mutate(perc_increase = row_number())
df_threshold_MMS_plot <- df_threshold_MMS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
# Prepare data for plotting
df_threshold_MMS %>% as_tibble() %>% mutate(perc_increase = row_number())
# Prepare data for plotting
df_threshold_MMS <- df_threshold_MMS %>% as_tibble() %>% mutate(perc_increase = row_number())
df_threshold_MMS_plot <- df_threshold_MMS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
View(df_threshold_MMS_plot)
## Threshold plots ##
# MMS
p <- ggplot(df_threshold_MMS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario))+
geom_point(aes(color = scenario))
p
df_threshold_TS <- df_threshold_TS %>% as_tibble() %>% mutate(perc_increase = row_number())
df_threshold_TS_plot <- df_threshold_TS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
df_threshold_TS <- df_threshold_TS %>% as_tibble() %>% mutate(perc_increase = row_number())
df_threshold_MMS_plot <- df_threshold_MMS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
df_threshold_TS_plot <- df_threshold_TS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
# TS
plot_DSA_TS_threshold <- ggplot(df_threshold_TS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario))+
geom_point(aes(color = scenario))
plot_DSA_TS_threshold
plot_DSA_TS_threshold <- ggplot(df_threshold_TS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario))#+
#geom_point(aes(color = scenario))
plot_DSA_TS_threshold
# TS
plot_DSA_TS_threshold <- ggplot(df_threshold_TS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0)
plot_DSA_TS_threshold
# TS
plot_DSA_TS_threshold <- ggplot(df_threshold_TS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
xlim(0, 100) +
ylim(-0.025, 0.025)
plot_DSA_TS_threshold
# TS
plot_DSA_TS_threshold <- ggplot(df_threshold_TS_plot, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
xlim(0, 100) +
ylim(-0.01, 0.025)
plot_DSA_TS_threshold
df_threshold_qalys_TS <- df_threshold_TS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
df_threshold_icer_TS <- df_threshold_TS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_icer_TOTAL_5yr, n_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, icer)
View(df_threshold_icer_TS)
plot_DSA_icer_TS_threshold <- ggplot(df_threshold_icer_TS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) #+
#xlim(0, 100) +
#ylim(-0.01, 0.025)
plot_DSA_icer_TS_threshold
View(df_threshold_TS)
df_threshold_icer_TS <- df_threshold_TS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_icer_TOTAL_5yr, n_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
mutate(icer = ifelse(icer > 0, icer, NA)) %>%
select(perc_increase, scenario, icer)
View(df_threshold_icer_TS)
# ICER
plot_DSA_icer_TS_threshold <- ggplot(df_threshold_icer_TS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) #+
#xlim(0, 100) +
#ylim(-0.01, 0.025)
plot_DSA_icer_TS_threshold
# ICER
plot_DSA_icer_TS_threshold <- ggplot(df_threshold_icer_TS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 100000) +
#xlim(0, 100) +
ylim(0, 2000000)
plot_DSA_icer_TS_threshold
# ICER
plot_DSA_icer_TS_threshold <- ggplot(df_threshold_icer_TS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 100000) #+
#xlim(0, 100) +
#ylim(0, 2000000)
plot_DSA_icer_TS_threshold
# ICER
plot_DSA_icer_TS_threshold <- ggplot(df_threshold_icer_TS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 100000) +
#xlim(0, 100) +
ylim(0, 20000000)
plot_DSA_icer_TS_threshold
# MMS
df_threshold_qalys_MMS <- df_threshold_MMS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
df_threshold_icer_MMS <- df_threshold_MMS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_inc_icer_TOTAL_5yr, n_inc_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
mutate(icer = ifelse(icer > 0, icer, NA)) %>%
select(perc_increase, scenario, icer)
# TS
df_threshold_qalys_TS <- df_threshold_TS %>% gather("scenario", "inc_qalys", n_inc_qalys_TOTAL_1yr, n_inc_qalys_TOTAL_5yr, n_inc_qalys_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
select(perc_increase, scenario, inc_qalys)
df_threshold_icer_TS <- df_threshold_TS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_icer_TOTAL_5yr, n_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
mutate(icer = ifelse(icer > 0, icer, NA)) %>%
select(perc_increase, scenario, icer)
df_threshold_icer_MMS <- df_threshold_MMS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_inc_icer_TOTAL_5yr, n_inc_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
mutate(icer = ifelse(icer > 0, icer, NA)) %>%
select(perc_increase, scenario, icer)
df_threshold_icer_MMS <- df_threshold_MMS %>% gather("scenario", "icer", n_icer_TOTAL_1yr, n_icer_TOTAL_5yr, n_icer_TOTAL_10yr, na.rm = FALSE, convert = FALSE) %>%
mutate(icer = ifelse(icer > 0, icer, NA)) %>%
select(perc_increase, scenario, icer)
plot_DSA_qalys_MMS_threshold <- ggplot(df_threshold_qalys_MMS, aes(x = perc_increase, y = inc_qalys, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
xlim(0, 100) +
ylim(-0.01, 0.025)
plot_DSA_qalys_MMS_threshold
# ICER
plot_DSA_icer_MMS_threshold <- ggplot(df_threshold_icer_MMS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 100000) #+
plot_DSA_icer_MMS_threshold
View(df_threshold_icer_MMS)
# ICER
plot_DSA_icer_MMS_threshold <- ggplot(df_threshold_icer_MMS, aes(x = perc_increase, y = icer, group = scenario)) +
geom_line(aes(color = scenario)) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 100000) +
#xlim(0, 100) +
ylim(0, 50000000)
plot_DSA_icer_MMS_threshold
